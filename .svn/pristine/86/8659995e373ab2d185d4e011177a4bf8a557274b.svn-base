using System;
using System.Data;
using System.Configuration;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Web.UI.HtmlControls;
using System.Data.SqlClient;
using DAL;
namespace StubAPI.BAL
{
    public class UserDetails
    {
        public UserDetails()
        {
            //
            // TODO: Add constructor logic here
            //
        }
        public string IsUserExists(string mobile, string emailIdAccess)
        {
            string result = string.Empty;
            int noOfEffectedRows = 0;          
            try
            {
                string spName = "spCheck_DuplicateUserDetails";
                SqlParameter[] parameters = new SqlParameter[3];
                parameters[0] = new SqlParameter("@Mobile", mobile);
                parameters[1] = new SqlParameter("@Email", emailIdAccess);              
                parameters[2] = new SqlParameter("@ErrorMessage", result);
                parameters[2].Direction = ParameterDirection.Output;
                noOfEffectedRows = SqlHelper.ExecuteNonQuery(SqlHelper.GetConnectionString(), CommandType.StoredProcedure, spName, parameters);
                result = parameters[2].Value.ToString();               
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return result;
        }
        public bool SaveUserDetails(string userXmlData,string source, int userId)
        {
            bool result = false;
            int noOfEffectedRows = 0;
            int outParamSave = 0;
            try
            {
                string spName = "spUser_UserDetailsSave";
                SqlParameter[] parameters = new SqlParameter[4];
                parameters[0] = new SqlParameter("@ImportData", userXmlData);
                parameters[1] = new SqlParameter("@ExistingUserID", userId);
                parameters[2] = new SqlParameter("@Source", source);
                parameters[3] = new SqlParameter("@IsSaved", outParamSave);
                parameters[3].Direction = ParameterDirection.Output;
                noOfEffectedRows = SqlHelper.ExecuteNonQuery(SqlHelper.GetConnectionString(), CommandType.StoredProcedure, spName, parameters);
                outParamSave = parameters[3].Value==null?0:Convert.ToInt32(parameters[3].Value);
                if (outParamSave > 0)
                {
                    result = true;
                }
            }
            catch (Exception ex)
            {
                throw ex;               
            }
            return result;
        }

        public string IsUserBusinessExists(int userId, int businessType)
        {
            string result = string.Empty;
            int noOfEffectedRows = 0;
            try
            {
                string spName = "spCheck_DuplicateUserBusinessDetails";
                SqlParameter[] parameters = new SqlParameter[3];
                parameters[0] = new SqlParameter("@UserId", userId);
                parameters[1] = new SqlParameter("@BusinessType", businessType);
                parameters[2] = new SqlParameter("@ErrorMessage", result);
                parameters[2].Direction = ParameterDirection.Output;
                noOfEffectedRows = SqlHelper.ExecuteNonQuery(SqlHelper.GetConnectionString(), CommandType.StoredProcedure, spName, parameters);
                result = parameters[2].Value.ToString();
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return result;
        }
        public bool SaveUserBusinessDetails(string userXmlData, int userBusinessId)
        {
            bool result = false;
            int noOfEffectedRows = 0;
            int outParamSave = 0;
            try
            {
                string spName = "spUserBusiness_UserBusinessSave";
                SqlParameter[] parameters = new SqlParameter[3];
                parameters[0] = new SqlParameter("@ImportData", userXmlData);
                parameters[1] = new SqlParameter("@ExistingBUID", userBusinessId);              
                parameters[2] = new SqlParameter("@IsSaved", outParamSave);
                parameters[2].Direction = ParameterDirection.Output;
                noOfEffectedRows = SqlHelper.ExecuteNonQuery(SqlHelper.GetConnectionString(), CommandType.StoredProcedure, spName, parameters);
                outParamSave = parameters[2].Value == null ? 0 : Convert.ToInt32(parameters[2].Value);
                if (outParamSave > 0)
                {
                    result = true;
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return result;
        }
    }
}